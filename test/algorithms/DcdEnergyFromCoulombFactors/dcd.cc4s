CoulombVertexReader [
  (file "../../resources/CoulombVertex.bin")
] [
  CoulombVertex HoleEigenEnergies ParticleEigenEnergies
  % Default value of readRank is No.
% (readRank 40)
].

CoulombVertexDecomposition [
  CoulombVertex
  (rank 66) (maxIterations 20)
] [
  FactorOrbitals CoulombFactors
  ComposedCoulombVertex
].

CoulombIntegralsFromVertex [
  % Compute the Coulomb integrals from the composed vertex
  % rather than from the original one, for comparability
  (CoulombVertex ComposedCoulombVertex)
% CoulombVertex
  HoleEigenEnergies ParticleEigenEnergies
] [
  % PPPPCoulombIntegrals are not needed.
% PPPPCoulombIntegrals
  PHPHCoulombIntegrals
  PPHHCoulombIntegrals HHHHCoulombIntegrals
].

% Compute the DcdEnergy from the integrals using slicing
DcdEnergyFromCoulombIntegrals [
  % PPPPCoulombIntegrals are not needed.
% PPPPCoulombIntegrals
  % For slicing use the composed vertex
  % rather than from the original one, for comparability
  (CoulombVertex ComposedCoulombVertex)
% CoulombVertex
  PHPHCoulombIntegrals
  PPHHCoulombIntegrals HHHHCoulombIntegrals
  ParticleEigenEnergies HoleEigenEnergies
  % Sets maximum iterations. Default is 16.
  (maxIterations 16)
  % Uncomment next line to set the slice rank of PPPPCoulombIntegrals. Default is No.
% (sliceRank 40)
] [
  (DcdEnergy DcdEnergy) 
  (DcdDoublesAmplitudes DcdDoublesAmplitudes)
].

TensorWriter [(Data DcdEnergy)] [].

% Compute the DcdEnergy from the Coulomb factors
DcdEnergyFromCoulombFactors [
  % PPPPCoulombIntegrals are not needed.
% PPPPCoulombIntegrals
  % Coulomb factors are used when necessary for low memory and O(N^5)
  FactorOrbitals CoulombFactors
  PHPHCoulombIntegrals
  PPHHCoulombIntegrals HHHHCoulombIntegrals
  ParticleEigenEnergies HoleEigenEnergies
  % Sets maximum iterations. Default is 16.
  (maxIterations 16)
  % the LinearMixer is used by default
% (mixer "LinearMixer")
% (mixingRatio 1.5)
] [
  (DcdEnergy DcdEnergyFactors)
  (DcdDoublesAmplitudes DcdDoublesAmplitudesFactors)
].

TensorWriter [(Data DcdEnergyFactors)] [].
