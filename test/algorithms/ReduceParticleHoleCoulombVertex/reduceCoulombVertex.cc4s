% RPA execution plan for large systems with Nv * No > NG
% N**5 implementation
ParticleHoleCoulombVertexReader [
  (file "../../resources/ParticleHoleCoulombVertex.bin")
] [
  ParticleHoleCoulombVertex HoleEigenEnergies ParticleEigenEnergies
].

ParticleHoleCoulombIntegrals [
  ParticleHoleCoulombVertex
] [
  PPHHCoulombIntegrals
].

% Compute RPA energy directly from Vertex
DrccdEnergyFromCoulombVertex [
  PPHHCoulombIntegrals
  ParticleHoleCoulombVertex
  HoleEigenEnergies ParticleEigenEnergies
  % just calculate MP2
  (maxIterations 1)
] [
  DrccdEnergy 
  DrccdDoublesAmplitudes
].

EnergyMatrixFromDoublesAmplitudes [
  ParticleHoleCoulombVertex
  % FIXME: for testing
  PPHHCoulombIntegrals
  HoleEigenEnergies ParticleEigenEnergies
  (DoublesAmplitudes DrccdDoublesAmplitudes)
] [
  EnergyMatrix
].

ReduceParticleHoleCoulombVertex [
  ParticleHoleCoulombVertex
  EnergyMatrix
] [
  ReducedParticleHoleCoulombVertex
].

